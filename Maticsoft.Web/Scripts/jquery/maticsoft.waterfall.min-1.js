/*
* File:        maticsoft.waterfall.js
* Author:      yaoy@maticsoft.com
* Copyright Â© 2004-2013 Maticsoft. All Rights Reserved.
*/$(function(){waterFall.ScrollTop=document.documentElement.scrollTop||document.body.scrollTop});var waterFall={AjaxOptions:{Type:"POST",Params:{},DataURL:null,Async:!0,DataType:"html",Success:null,Error:null},CurrentAjaxStartIndexHF:null,StartIndex:0,EndIndex:0,PagedContainer:null,ColumnFirstId:null,ColumnNumber:3,RowNumber:0,LoadDataCount:0,ScrollTop:0,LoadFinish:!1,ScrollTrigger:100,scroll:function(){return $(window).scroll(function(){var e=document.documentElement.scrollTop||document.body.scrollTop;!waterFall.LoadFinish&&Math.abs(e-waterFall.ScrollTop)>waterFall.ScrollTrigger&&(waterFall.ScrollTop=e,waterFall.appendDetect())}),this},appendDetect:function(){var e;if(waterFall.ColumnNumber){var t=0;for(t;t<waterFall.ColumnNumber;t++)e=document.getElementById(waterFall.ColumnFirstId+t),e&&!waterFall.LoadFinish&&e.offsetTop+e.clientHeight<waterFall.ScrollTop+(window.innerHeight||document.documentElement.clientHeight)&&waterFall.append(e)}else{e=document.getElementById(waterFall.ColumnFirstId);if(e&&!waterFall.LoadFinish&&e.offsetTop+e.clientHeight<waterFall.ScrollTop+(window.innerHeight||document.documentElement.clientHeight)){waterFall.append(e);if(waterFall.RowNumber&&waterFall.RowNumber>1)for(var n=2;n<waterFall.RowNumber;n++)waterFall.append(e)}}return this},append:function(e){if(waterFall.StartIndex>=waterFall.EndIndex)return waterFall.LoadFinish=!0,waterFall.PagedContainer.show(),this;var t={StartIndex:waterFall.StartIndex};return waterFall.LoadDataCount+=1,waterFall.CurrentAjaxStartIndexHF.val(++waterFall.StartIndex),$.ajax({type:waterFall.AjaxOptions.Type,url:waterFall.AjaxOptions.DataURL,async:waterFall.AjaxOptions.Async,dataType:waterFall.AjaxOptions.DataType,data:$.extend(waterFall.AjaxOptions.Params,t),success:function(t){if(!t){waterFall.LoadFinish=!0,waterFall.PagedContainer.show();return}var n=$(t);$(e).append(n),waterFall.AjaxOptions.Success&&waterFall.AjaxOptions.Success.call(n)},error:function(e,t,n,r){waterFall.AjaxOptions.Error&&waterFall.AjaxOptions.Error.call(e,t,n,r)}}),waterFall.StartIndex>=waterFall.EndIndex?(waterFall.LoadFinish=!0,waterFall.PagedContainer.show(),this):this},refresh:function(){return waterFall.appendDetect(),this},resize:function(){return window.onresize=function(){waterFall.refresh()},this},init:function(e){var t={AjaxOptions:{Params:{AlbumId:$.getUrlParam("AlbumID")},DataURL:"WaterfallPhotoListData"},CurrentAjaxStartIndexHF:$("#hfCurrentPageAjaxStartIndex"),StartIndex:$("#hfCurrentPageAjaxStartIndex").val()?parseInt($("#hfCurrentPageAjaxStartIndex").val()):0,EndIndex:$("#hfCurrentPageAjaxEndIndex").val()?parseInt($("#hfCurrentPageAjaxEndIndex").val()):0,PagedContainer:$(".in_pages"),ColumnFirstId:"col_",ColumnNumber:3,RowNumber:0,ScrollTrigger:100};e&&(t=$.extend(t,e)),t.PagedContainer.hide();if(t.CurrentAjaxStartIndexHF.length==0)return;if(t.StartIndex==0||t.EndIndex==0)return;this.CurrentAjaxStartIndexHF=t.CurrentAjaxStartIndexHF,this.ColumnFirstId=t.ColumnFirstId,this.ColumnNumber=t.ColumnNumber,this.RowNumber=t.RowNumber,this.PagedContainer=t.PagedContainer,this.StartIndex=t.StartIndex,this.EndIndex=t.EndIndex,this.AjaxOptions=$.extend(this.AjaxOptions,t.AjaxOptions),this.StartIndex&&this.ColumnFirstId&&($(document).scrollTop(0),this.LoadFinish=!1,this.scroll().refresh().resize())}};