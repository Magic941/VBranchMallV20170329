var $slidePlay={json:null,params:{offsetX:100,offsetY:200,playtime:3000,interval:30},format:function(){if(this.json&&this.json.currentUrl&&$isArr(this.json.data)){this.params.total=this.json.data.length,flagRepeat=false;this.json.data.each(function(b,a){if(flagRepeat){return}if(this.json.currentUrl===b.url||b.url.replace(this.json.currentUrl,"")!==b.url){this.params.index=a;flagRepeat=true}}.bind(this));if($chk(this.params.index)){this.get();this.events()}}return this},is360:function(){var c=this.json.fullviewUrl,a=false,b=this.json.data[this.params.index].url;if($isArr(c)&&c.length){c.each(function(d){if(d==b){a=true}})}this.params.fullview=a;return this},able:function(b){var a="slide_"+b.retrieve("key");b.swapClass(a+"_off",a).store("click",true);return this},disable:function(b){var a="slide_"+b.retrieve("key");b.swapClass(a,a+"_off").store("click",false);return this},style:function(){if(this.params.total>1){if(this.params.index===0){this.disable(this.prev)}else{this.able(this.prev)}if(this.params.index<this.params.total-1){this.able(this.play);this.able(this.next)}else{this.disable(this.play);this.disable(this.next)}}else{this.disable(this.play);this.disable(this.next);this.disable(this.prev)}this.able(this.stop);if(this.params.fullview){this.disable(this.play);this.disable(this.stop)}this.index.txt((this.params.index+1)+" / "+this.params.total);return this},get:function(){this.is360().style();var b=this.json.data[this.params.index].url,a=new Image();a.onload=function(){this.params.width=a.width;this.params.height=a.height;this.size().show()}.bind(this);a.onerror=function(){this.size().error()}.bind(this);a.src=b;return this},size:function(){var a={x:this.params.width,y:this.params.height,winw:$(window).getWidth()-this.params.offsetX,winh:$(window).getHeight()-this.params.offsetY};var c=a.x/a.y,b=a.winw/a.winh;if(this.params.fullview){a.y=(a.y<a.winh)?a.y:a.winh;a.x=a.y*c}else{if(c>b){if(a.x>a.winw){a.x=a.winw;a.y=a.x/c}}else{if(a.y>a.winh){a.y=a.winh;a.x=a.y*c}}}if(a.x<a.winw){this.params.fullview=false}this.params.size=a;return this},show:function(){var c=this.json.data[this.params.index],b=this.params.size,a=(b.winh-b.y)/2;this.image=new Element("img",{src:c.url}).w(b.x||"auto").h(b.y);this.title=new Element("h3",{"class":"f16 mt10 wh"}).txt(c.title);this.passer=new Element("p",{"class":"g6"}).txt(c.passer?("上传者："+c.passer):"");this.box.w(this.params.fullview?b.winw:b.x).empty().adopt([this.image,this.title,this.passer]).css("margin-top",(a<40)?40:a);this.fullview();return this},error:function(){var a=this.params.size;this.failed=new Element("h3",{styles:{paddingTop:a.winh/3,fontSize:30,color:"#ffffff",textAlign:"center"}}).txt("抱歉，此图片加载没有成功");this.box.w(a.winw).empty().adopt(this.failed).css("margin-top",40);return this},fullview:function(){var g="left",d=true,f=false,b=this.params.size.winw-this.params.size.x;var a={imgleft:0,posleft:0};if(this.params.fullview){$clear(this.params.timerView);var c=function(){var h=this.image.css("margin-left").toInt()||0;if(h>0){g="left"}else{if(h<b){g="right"}}if(g==="left"){this.image.css("margin-left",h-1)}else{this.image.css("margin-left",h+1)}}.bind(this);var e=function(h){if(h>0){h=0}else{if(h<b){h=b}}return h}.bind(this);this.params.timerView=c.periodical(this.params.interval);this.image.addEvents({mouseover:function(){$clear(this.params.timerView)}.bind(this),mouseout:function(){if(d){this.params.timerView=c.periodical(this.params.interval)}}.bind(this),mousedown:function(h){d=false;f=true;a.imgleft=this.image.css("margin-left").toInt()||0;a.posleft=h.page.x;return false}.bind(this)});document.addEvent("mousemove",function(i){if(f&&this.params.fullview){var j=i.page.x-a.posleft,h=a.imgleft+j;h=e(h);this.image.css("margin-left",h)}return false}.bind(this));document.addEvent("mouseup",function(i){if(this.params.fullview&&f){var h=i.page.x-a.posleft;if(h>0){g="right"}else{g="left"}f=false;d=true}}.bind(this))}else{$clear(this.params.timerView)}},wait:function(){if(this.image){this.image.src="http://s1.95171.cn/b/img/pixel.gif";if(this.params.fullview){$clear(this.params.timerView);this.image.css("margin-left",(this.params.size.winw-this.params.width)/2)}this.title.dispose();this.passer.dispose()}return this},forward:function(){this.params.index++;if(this.params.index<this.params.total){this.get()}if(this.params.index===this.params.total-1){this.stop.out();this.play.into();$clear(this.params.timerPlay)}return this},back:function(){this.params.index--;if(this.params.index>-1){this.get()}return this},events:function(){$(window).addEvent("resize",function(){this.get()}.bind(this));this.next.addEvent("click",function(b){var a=new Event(b).target;if(a.retrieve("click")){this.wait().forward()}return false}.bind(this));this.prev.addEvent("click",function(b){var a=new Event(b).target;if(a.retrieve("click")){this.wait().back()}return false}.bind(this));this.play.addEvent("click",function(b){var a=new Event(b).target;if(a.retrieve("click")){a.out();this.stop.into();this.params.timerPlay=this.forward.bind(this).periodical(this.params.playtime)}return false}.bind(this));this.stop.addEvent("click",function(b){var a=new Event(b).target;if(a.retrieve("click")){a.out();this.play.into();$clear(this.params.timerPlay)}return false}.bind(this))},init:function(){this.prev=$("slidePrev");this.next=$("slideNext");this.play=$("slidePlay");this.stop=$("slideStop");this.index=$("slideIndex");this.box=$("slideBox");if(this.stop&&this.next&&this.play&&this.prev&&this.index&&this.box){this.stop.store("key","stop").store("click",false);this.next.store("key","next").store("click",false);this.play.store("key","play").store("click",false);this.prev.store("key","prev").store("click",false);this.format()}}};