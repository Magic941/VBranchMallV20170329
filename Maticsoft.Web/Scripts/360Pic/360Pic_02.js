String.implement({cnEncode:function(){return encodeURIComponent(this)},cnDecode:function(){return decodeURIComponent(this)},charCode:function(){var a=this.length,c="";for(var b=0;b<a;b+=1){c+=this.charCodeAt(b)}return c},trimHTML:function(){var a={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"},b=/[&<>"]/g;return this.replace(b,function(c){return a[c]})},stripHTML:function(){return this.replace(/<(?:.|\s)*?>/g,"")},trimSearch:function(){return DBC2SBC(this.trim()).replace(/[^a-zA-Z0-9\u4E00-\u9FA5 \-\_，\']/g,"").slice(0,50)}});Element.implement({appendHTML:function(c,b){if($type(c)!="string"){return false}b=b||"bottom";var a=new Element("div");a.set("html",c);var d=(b=="bottom"||b=="before")?$A(a.childNodes):$A(a.childNodes).reverse();d.each(function(e){if($type(e)=="element"){$(e).inject(this,b)}},this);return this},css:function(a,b){if($type(a)=="object"){for(var c in a){this.css(c,a[c])}return this}if(!$chk(b)){return this.getStyle(a)}this.setStyle(a,b);return this},attr:function(a,b){if($type(a)=="object"){for(var c in a){this.attr(c,a[c])}return this}if(!$chk(b)){if(b===""){return this.removeProperty(a)}return this.getProperty(a)}this.setProperty(a,b);return this},val:function(a){if($chk(a)||a==""){return this.set("value",a)}else{return this.get("value")}},w:function(a){if($chk(a)){return this.css("width",a)}else{return this.getWidth()}},h:function(a){if($chk(a)){return this.css("height",a)}else{return this.getHeight()}},html:function(a){if($chk(a)||a==""){return this.set("html",a)}else{return this.get("html")}},txt:function(a){if($chk(a)||a==""){return this.set("text",a)}else{return this.get("text")}},isDisplayed:function(){return this.getStyle("display")!="none"},toggle:function(){return this[this.isDisplayed()?"hide":"show"]()},hide:function(){return this.css("display","none")},show:function(a){return this.css("display",a||"block")},visible:function(){return this.css("visibility","visible")},invisible:function(){return this.css("visibility","hidden")},out:function(){return this.css({position:"absolute",top:"-9999px",left:"-9999px"})},into:function(){return this.css("position","static")},swapClass:function(a,b){return this.removeClass(a).addClass(b)}});var $isFun=function(a){return $type(a)==="function"},$isEle=function(a){return $type(a)==="element"},$isObj=function(a){return $type(a)==="object"},$isArr=function(a){return $type(a)==="array"},$isStr=function(a){return $type(a)==="string"},$isNum=function(a){return $type(a)==="number"},$isIe6=function(){return window.XMLHttpRequest?false:true}();var DBC2SBC=function(b){var a="";for(i=0;i<b.length;i++){code=b.charCodeAt(i);if(code>=65281&&code<=65373){a+=String.fromCharCode(b.charCodeAt(i)-65248)}else{if(code==12288){a+=String.fromCharCode(b.charCodeAt(i)-12288+32)}else{a+=b.charAt(i)}}}return a};var $isRegex=function(b,a,c){return $(b).get("value").trim().test(a,c||"i")},$isEmpty=function(c,b){b=b||$(c).getProperty("placeholder");var a=$(c).get("value").trim();if(!a||a===b){return true}return false};$isRegex.extend({EMAIL:"^[a-z0-9._%-]+@([a-z0-9-]+\\.)+[a-z]{2,4}$",URL:"^(http|https|ftp)\\:\\/\\/[a-z0-9\\-\\.]+\\.[a-z]{2,3}(:[a-z0-9]*)?\\/?([a-z0-9\\-\\._\\?\\,\\'\\/\\\\\\+&amp;%\\$#\\=~])*$",MOBILE:"^1\\d{10}$",ZIPCODE:"^\\d{6}$"});var $pageFresh=function(a){window.location.href=a||window.location.href.split("#")[0]};var $classToggle=function(d,a){var c={addClass:"",removeClass:"",eventType:"hover",inCall:$empty,outCall:$empty};var b=$extend(c,a||{});if($isStr(b.removeClass)&&$isStr(b.addClass)){if($isEle(d)){d=[d]}if($isArr(d)){d.each(function(e){if($isEle(e)){if(b.eventType==="hover"){e.addEvents({mouseenter:function(){this.swapClass(b.removeClass,b.addClass);if($isFun(b.inCall)){b.inCall.call(this)}},mouseleave:function(){this.swapClass(b.addClass,b.removeClass);if($isFun(b.outCall)){b.outCall.call(this)}}})}else{if(b.eventType==="click"){e.addEvents({mousedown:function(){this.swapClass(b.removeClass,b.addClass);if($isFun(b.inCall)){b.inCall.call(this)}},mouseup:function(){this.swapClass(b.addClass,b.removeClass);if($isFun(b.outCall)){b.outCall.call(this)}}})}else{if(b.eventType==="focus"){e.addEvents({focus:function(){this.swapClass(b.removeClass,b.addClass);if($isFun(b.inCall)){b.inCall.call(this)}},blur:function(){this.swapClass(b.addClass,b.removeClass);if($isFun(b.outCall)){b.outCall.call(this)}}})}}}}})}}};var $visibleToggle=function(c,a){var e={attribute:"rel",eventType:"click",property:"position",display:false,showCall:$empty,hideCall:$empty};var b=$extend(e,a||{}),d;if($isEle(c)){c=[c]}if($isArr(c)){c.each(function(f){f.store("display",b.display).addEvent(b.eventType,function(){var g=$(this.attr(b.attribute))||$$("."+this.attr(b.attribute));if(this.retrieve("display")){if(b.property==="position"){g.out()}else{if(b.property==="display"){g.hide()}else{if(b.property==="visibility"){g.invisible()}}}f.store("display",false);if($isFun(b.hideCall)){b.hideCall.call(this,g)}}else{if(b.property==="position"){g.into()}else{if(b.property==="display"){g.show()}else{if(b.property==="visibility"){g.visible()}}}f.store("display",true);if($isFun(b.showCall)){b.showCall.call(this,g)}}if(this.get("tag")==="a"){return false}})})}};var $tabSwitch=function(a,l){var f={eventType:"click",classAdd:"",classRemove:"",property:"position",targetAttr:"rel",timeDelay:100,timePlay:0,switchCall:$empty};var h=$extend(f,l||{}),b,g,e,c,d=h.timeDelay.toInt(),j=h.timePlay.toInt();h.elementCache=null;h.indexCache=-1;var k=function(p,q){var n=h.elementCache,m,o;if(h.eventType==="hover"){if($isNum(q)){h.indexCache=q}else{if(j>0){h.indexCache=(h.indexCache===b-1)?0:h.indexCache+1;e=k.delay(j)}}}p=p||a[h.indexCache];if($isEle(p)){p.swapClass(h.classRemove,h.classAdd);if(o=$(p.attr(h.targetAttr))){if(h.property==="position"){o.into()}else{if(h.property==="display"){o.show()}}}h.elementCache=p}else{return}if($isEle(n)&&n!==p){n.swapClass(h.classAdd,h.classRemove);if(m=$(n.attr(h.targetAttr))){if(h.property==="position"){m.out()}else{if(h.property==="display"){m.hide()}}}}if($isFun(h.switchCall)){h.switchCall.call(p,o,n,m)}};if($isArr(a)&&(b=a.length)){if(!h.classAdd){h.elementCache=a[0];h.indexCache=0}a.each(function(n,m){if(h.classAdd&&n.hasClass(h.classAdd)){h.elementCache=n;h.indexCache=m}switch(h.eventType){case"click":n.addEvent("click",function(){if(!this.hasClass(h.classAdd)){k(this)}if(this.get("tag")==="a"){return false}});break;case"hover":n.addEvents({mouseenter:function(){if(j>0){$clear(c);$clear(e)}if(!this.hasClass(h.classAdd)){if(d>0){g=k.pass([this,m]).delay(d)}else{h.indexCache=m;k(this)}}},mouseleave:function(){$clear(g);if(j>0){c=k.delay(j)}}})}});if($chk(j)&&h.eventType==="hover"){c=k.delay(j)}}};var $powerFloat=function(e,c){if($isEle(e)){e=[e]}if(!$isArr(e)){return false}var f={width:"auto",offsets:{x:0,y:0},zIndex:19,eventType:"hover",showDelay:0,hideDelay:0,hoverHold:true,targetMode:"common",target:null,targetAttr:"rel",container:null,reverseSharp:false,position:"4-1",edgeAdjust:true,showCall:$empty,hideCall:$empty};var h={targetGet:function(){if(!this.trigger){return this}var o=this.trigger.attr(this.s.targetAttr),n=this.trigger.retrieve("powerFloatTarget")||this.s.target;switch(this.s.targetMode){case"common":if(n){if($isEle(n)){h.target=n}else{if($isArr(n)&&$isEle(n[0])){h.target=n[0]}else{if($isStr(n)&&$(n)){h.target=$(n)}}}}else{if(o&&$(o)){h.target=$(o)}}if(h.target){h.targetShow()}return this;break;case"ajax":var j=n||o;this.targetProtect=false;if(/(\.jpg|\.png|\.gif|\.bmp|\.jpeg)$/i.test(j)){var m=new Image();h.loading();m.onload=function(){var s=m.width,x=m.height;var v=$(window).getWidth(),z=$(window).getHeight();var y=s/x,u=v/z;if(y>u){if(s>v/2){s=v/2;x=s/y}}else{if(x>z/2){x=z/2;s=x*y}}var t=new Element("img").attr({width:s,height:x,src:j,"class":"float_ajax_image"});h.target=t;h.targetShow()};m.onerror=function(){h.target=new Element("div").addClass("float_ajax_error").html("图片加载失败！");h.targetShow()};m.src=j}else{if(j){h.loading();new Request.HTML({method:"get",url:j,onComplete:function(s,u,t,v){h.target=new Element("div").addClass("float_ajax_data").html(t);h.targetShow()},onFailure:function(){h.target=new Element("div").addClass("float_ajax_error").html("数据没有加载成功。");h.targetShow()}}).send()}}break;case"list":var k=new Element("ul").addClass("float_list_ul"),q="",p;if($isArr(n)&&(p=n.length)){n.each(function(v,t){var u="",x="",w,s;if(t===0){x=' class="float_list_li_first"'}if(t===p-1){x=' class="float_list_li_last"'}if($isObj(v)&&(w=v.text.toString())){if(s=(v.href||"javascript:")){u='<a href="'+s+'" class="float_list_a">'+w+"</a>"}else{u=w}}else{if(v&&$isStr(v)){u=v}}if(u){q+="<li"+x+">"+u+"</li>"}})}else{q+='<li class="float_list_null">列表无数据。</li>'}h.target=k.html(q);this.targetProtect=false;h.targetShow();break;case"remind":var r=n||o;this.targetProtect=false;if($isStr(r)){h.target=new Element("span").html(r);h.targetShow()}break;default:var l=n||o;if(l){if($isStr(l)){if($$(l).length){h.target=$$(l)[0];this.targetProtect=true}else{h.target=new Element("div").html(l)}}else{if($isEle(l)){h.target=l}else{if($isArr(l)&&$isEle(l[0])){h.target=l[0]}}}h.targetShow()}}return this},container:function(){var j=this.s.container,k=this.s.targetMode||"mode";if(k==="ajax"||k==="remind"){this.s.sharpAngle=true}else{this.s.sharpAngle=false}if(this.s.reverseSharp){this.s.sharpAngle=!this.s.sharpAngle}if(k!=="common"){if(j===null){j="plugin"}if(j==="plugin"){if(!$("floatBox_"+k)){new Element("div").attr("id","floatBox_"+k).addClass("float_"+k+"_box").out().inject(document.body)}j=$("floatBox_"+k)}if(j&&!$isStr(j)){if(this.targetProtect){h.target.show().into()}h.target=j.empty().adopt(h.target)}}return this},setWidth:function(){var j=this.s.width;if(j==="auto"){if(this.target.style.width){this.target.css("width","auto")}}else{if(j==="inherit"){this.target.w(this.trigger.w())}else{this.target.css("width",j)}}return this},position:function(){var m=this.trigger.getPosition(),z=0,o=0,p=0,A=0,v,r,j,G,x,t,k=this.target.h(),E=this.target.w(),u=window.getScroll().y,D=this.s.offsets.x.toInt()||0,C=this.s.offsets.y.toInt()||0,z=this.trigger.h();o=this.trigger.w();v=m.x;r=m.y;var l=["4-1","1-4","5-7","2-3","2-1","6-8","3-4","4-3","8-6","1-2","7-5","3-2"],y=this.s.position,n;if(l.indexOf(y)===-1){y="4-1"}var F=function(H){var I="bottom";switch(H){case"1-4":case"5-7":case"2-3":I="top";break;case"2-1":case"6-8":case"3-4":I="right";break;case"1-2":case"8-6":case"4-3":I="left";break;case"4-1":case"7-5":case"3-2":I="bottom";break}return I},q=function(H){return["5-7","6-8","8-6","7-5"].indexOf(H)!==-1};var w=function(J){var K=0,H=0,I=(h.s.sharpAngle&&h.corner)?true:false;if(J==="right"){H=v+o+E+D;if(I){H+=h.corner.w()}if(H>$(window).getWidth()){return false}}else{if(J==="bottom"){K=r+z+k+C;if(I){K+=h.corner.h()}if(K>u+$(window).getHeight()){return false}}else{if(J==="top"){K=k+C;if(I){K+=h.corner.h()}if(K>r-u){return false}}else{if(J==="left"){H=E+D;if(I){H+=h.corner.w()}if(H>v){return false}}}}}return true};n=F(y);if(this.s.sharpAngle){this.createSharp(n)}if(this.s.edgeAdjust){if(w(n)){(function(){if(q(y)){return}var I={top:{right:"2-3",left:"1-4"},right:{top:"2-1",bottom:"3-4"},bottom:{right:"3-2",left:"4-1"},left:{top:"1-2",bottom:"4-3"}};var J=I[n],H;if(J){for(H in J){if(!w(H)){y=J[H]}}}})()}else{(function(){if(q(y)){var I={"5-7":"7-5","7-5":"5-7","6-8":"8-6","8-6":"6-8"};y=I[y]}else{var J={top:{left:"3-2",right:"4-1"},right:{bottom:"1-2",top:"4-3"},bottom:{left:"2-3",right:"1-4"},left:{bottom:"2-1",top:"3-4"}};var K=J[n],H=[];for(name in K){H.push(name)}if(w(H[0])||!w(H[1])){y=K[H[0]]}else{y=K[H[1]]}}})()}}var B=F(y),s=y.split("-")[0];if(this.s.sharpAngle){this.createSharp(B);p=this.corner.w(),A=this.corner.h()}switch(B){case"top":G=r-C-k-A;if(s=="1"){j=v-D}else{if(s==="5"){j=v-(E-o)/2-D}else{j=v-(E-o)-D}}t=r-A-C-1;x=v-(p-o)/2;break;case"right":j=v+o+D+p;if(s=="2"){G=r+C}else{if(s==="6"){G=r-(k-z)/2+C}else{G=r-(k-z)-C}}x=v+o+D+1;t=r-(A-z)/2;break;case"bottom":G=r+z+C+A;if(s=="4"){j=v+D}else{if(s==="7"){j=v-(E-o)/2+D}else{j=v-(E-o)+D}}t=r+z+C+1;x=v-(p-o)/2;break;case"left":j=v-E-D-p;if(s=="2"){G=r-C}else{if(s==="8"){G=r-(E-o)/2-C}else{G=r-(k-z)-C}}x=v-p-D-1;t=r-(A-z)/2;break}if(A&&p&&this.corner){this.corner.css({left:x,top:t,zIndex:this.s.zIndex+1})}this.target.css({position:"absolute",left:j,top:G,zIndex:this.s.zIndex});return this},createSharp:function(l){var o,p,r="",q="";var k={left:"right",right:"left",bottom:"top",top:"bottom"},m=k[l]||"top";this.cornerClear();if(this.target){o=this.target.css("background-color");if(this.target.css("border-"+m+"-width").toInt()>0){p=this.target.css("border-"+m+"-color")}if(p&&p!=="transparent"){r='style="color:'+p+';"'}else{r='style="display:none;"'}if(o&&o!=="transparent"){q='style="color:'+o+';"'}else{q='style="display:none;"'}}var n='<span class="corner corner_1" '+r+'>◆</span><span class="corner corner_2" '+q+">◆</span>";var j=new Element("div").attr("id","floatCorner_"+l).addClass("float_corner float_corner_"+l).html(n);if(!$("floatCorner_"+l)){j.inject(document.body)}this.corner=$("floatCorner_"+l);return this},targetHold:function(){if(this.s.hoverHold){var j=this.s.hideDelay.toInt()||200;if(this.target){this.target.addEvents({mouseenter:function(){this.flagDisplay=true}.bind(this),mouseleave:function(){this.flagDisplay=false;this.displayDetect()}.bind(this)});h.timerHold=this.displayDetect.delay(j,this)}}else{h.displayDetect()}return this},loading:function(){this.target=new Element("div").addClass("float_loading");this.targetShow();return this},displayDetect:function(){if(!this.flagDisplay){this.targetHide()}return this},targetShow:function(){h.cornerClear();this.container().setWidth().position();this.target.show();if($isFun(this.s.showCall)){this.s.showCall.call(this.trigger,this.target)}window.powerFloatHide=function(){h.targetHide()};this.display=true;return this},targetHide:function(){this.targetClear();this.cornerClear();if($isFun(this.s.hideCall)){this.s.hideCall.call(this.trigger)}this.target=null;this.trigger=null;this.s={};this.targetProtect=false;this.display=false;return this},targetClear:function(){if(this.target){if(this.targetProtect){this.target.getFirst().out().inject(document.body)}this.target.out()}},cornerClear:function(){if(this.corner){this.corner.dispose()}},target:null,trigger:null,s:{},cacheData:{},targetProtect:false};var b=function(m){if(!h.display){return false}var l=m.page.x,k=m.page.y,n=h.target.getPosition(),o=h.target.w(),j=h.target.h();if(h.s.eventType==="click"&&m.target!=h.trigger){if(!(l>n.x&&l<n.x+o&&k>n.y&&k<n.y+j)){h.flagDisplay=false;h.displayDetect();document.removeEvent("mouseup",b)}}return false},a;var d=$extend(f,c||{});var g=function(k,j){if(h.target&&h.display){h.targetHide()}h.s=k;h.trigger=j};e.each(function(j){switch(d.eventType){case"hover":j.addEvents({mouseenter:function(){if(h.timerHold){$clear(h.timerHold)}var k=d.showDelay.toInt();g(d,this);if(k){if(a){$clear(a)}a=h.targetGet.delay(k,h)}else{h.targetGet()}},mouseleave:function(){if(a){$clear(a)}h.flagDisplay=false;h.targetHold()}});break;case"click":j.addEvent("click",function(k){if(h.display&&k.target===h.trigger){h.flagDisplay=false;h.displayDetect()}else{g(d,this);h.targetGet()}document[h.display?"addEvent":"removeEvent"]("mouseup",b);return false});break;case"focus":j.addEvents({focus:function(){setTimeout(function(){g(d,this);h.targetGet()}.bind(this),200)},blur:function(){h.flagDisplay=false;setTimeout(function(){h.displayDetect()},190)}});break;default:g(d,j);h.targetGet()}})};$powerFloat.extend({hide:function(){if(window.powerFloatHide){powerFloatHide()}}});var $startDrag=function(a,b){var c={left:0,top:0,currentX:0,currentY:0,flag:false};a.addEvent("mousedown",function(d){c.flag=true;c.left=b.getPosition().x;c.top=b.getPosition().y;c.currentX=d.page.x;c.currentY=d.page.y});a.onselectstart=function(){return false};document.addEvents({mouseup:function(){c.flag=false},mousemove:function(j){if(c.flag){var f=j.page.x,d=j.page.y;var h=f-c.currentX,g=d-c.currentY;b.css({left:c.left+h,top:c.top+g})}}})};var $lazyLoading=function(b,a){var c={attr:"data-url",container:window,callback:$empty};var d=$extend(c,a||{});d.cache=[];if(d.container!==window&&!$isEle(d.container)){d.container=window}if($isEle(b)){b=[b]}b.each(function(j){var g=j.get("tag"),f=j.attr(d.attr)||"";var h={obj:j,tag:g,url:f};d.cache.push(h)});var e=function(){var f=d.container.getScroll().y,g=f+d.container.getHeight();d.cache.each(function(m){var n=m.obj,j=m.tag,k=m.url,l,h;if(n){if(d.container===window){l=n.getPosition().y}else{l=n.getPosition(d.container).y}h=l+n.h();if((l>f&&l<g)||(h>f&&h<g)){if(k){if(j==="img"){n.attr("src",k);d.callback.call(n)}else{n.set("load",{onSuccess:function(){d.callback.call(n)}});n.load(k)}}else{d.callback.call(n)}m.obj=null}}});return false};e();d.container.addEvent("scroll",e)};var $smoothSlide=function(b,a,j){if(!b||!a){return}var e={direct:"left",duration:"normal",index:0,visible:1,loop:1,name:"slide",autoTime:0,prev:null,next:null,prevCall:$empty,nextCall:$empty};var d=$extend(e,j||{});var f=new Hash(),k=0;a=$splat(a);d.length=a.length;if(d.length<d.visible){return}a.each(function(m,l){f[l]=-1*k;if(d.direct==="left"||d.direct==="right"){k+=m.w()}else{if(d.direct==="top"||d.direct==="bottom"){k+=m.h()}}});b.set("tween",{duration:d.duration}).css(d.direct,f[d.index]).store("autoTime",d.autoTime);var g=function(l){b.tween(d.direct,l)};var h=function(){var m=d.name+"_prev_disable",l=d.name+"_next_disable";if(d.prev){if(d.index<=0){d.prev.addClass(m).store("disable",true).setProperty("title","").blur();d.index=0}else{d.prev.removeClass(m).store("disable",false).setProperty("title",d.prev.retrieve("title"))}}if(d.next){if(d.index>=(d.length-d.visible)){d.next.addClass(l).store("disable",true).setProperty("title","").blur();d.index=d.length-d.visible}else{d.next.removeClass(l).store("disable",false).setProperty("title",d.next.retrieve("title"))}}};if(d.prev){d.prev.addEvent("click",function(){if(!this.retrieve("disable")){d.index-=d.loop;h();g(f[d.index]);if($isFun(d.prevCall)){d.prevCall.call(this,b,d.index)}}else{this.blur()}return false}).store("title",d.prev.getProperty("title"))}if(d.next){d.next.addEvent("click",function(){if(!this.retrieve("disable")){d.index+=d.loop;h();g(f[d.index]);if($isFun(d.nextCall)){d.nextCall.call(this,b,d.index)}}else{this.blur()}return false}).store("title",d.next.getProperty("title")||"")}h();if(d.autoTime.toInt()>0){var c=d.next;setInterval(function(){if(b.retrieve("autoTime")){c.fireEvent("click");if(c.retrieve("disable")){if(c==d.next){c=d.prev}else{c=d.next}}}},d.autoTime)}};var $testRemind=function(c,b,a){if($isEle(c)&&b){$powerFloat(c,{eventType:null,targetMode:"remind",target:b,zIndex:202,position:(a?"5-7":"1-4")})}};$testRemind.extend({hide:function(){var a=$("floatBox_remind");if(a){a.dispose();$$(".float_corner").dispose()}},bind:function(){if(!document.retrieve("testRemind")){document.addEvent("mousedown",function(a){if(a&&a.target.getParents("#floatBox_remind").length===0){$testRemind.hide()}}).store("testRemind",true)}}});var $verifyRefer={txtRemKey:"您尚未输入",txtRemKey2:"您输入的",txtRemKey3:"格式不正确",txtEmail:"邮箱",txtTel:"手机号码",txtPwd:"密码",txtCode:"验证码",txtZipcode:"邮编",txtUrl:"网址",funTestEmail:function(a,c){var b=DBC2SBC(a.val().trim());if($isEmpty(a)){if(c){$testRemind(a,this.txtRemKey+this.txtEmail,true);a.focus();return false}}else{if(!b.test($isRegex.EMAIL,"i")){$testRemind(a,this.txtRemKey2+this.txtEmail+this.txtRemKey3,true);a.focus();a.select();return false}}a.val(b);return true},funTestName:function(c,d,b){var a=this.txtRemKey;if(c.get("tag")==="select"){a=a.replace("输入","选择")}if(d&&$isEmpty(c)){$testRemind(c,a+(b||"您的昵称"),true);c.focus();return false}return true},funTestTel:function(a,c){var b=DBC2SBC(a.val().trim());if($isEmpty(a)){if(c){$testRemind(a,this.txtRemKey+this.txtTel,true);a.focus();return false}}else{if(!b.test($isRegex.MOBILE)){$testRemind(a,this.txtRemKey2+this.txtTel+this.txtRemKey3,true);a.focus();a.select();return false}}a.val(b);return true},funTestEmailTel:function(c,b){var a=DBC2SBC(c.val().trim());if($isEmpty(c)){if(b){$testRemind(c,this.txtRemKey+this.txtTel+"或"+this.txtEmail,true);c.focus();return false}}else{if(!a.test($isRegex.MOBILE)&&!a.test($isRegex.EMAIL,"i")){$testRemind(c,this.txtRemKey2+this.txtTel+"或"+this.txtEmail+this.txtRemKey3,true);c.focus();c.select();return false}}c.val(a);return true},funTestPwd:function(d,e){var c=d.val().length,a=d.attr("data-max"),b=d.attr("data-min");if(c===0){if(e){$testRemind(d,this.txtRemKey+this.txtPwd,true);d.focus();return false}}else{if(a&&c>a.toInt()){$testRemind(d,"密码长度不能大于"+a+"位",true);d.focus();d.select();return false}else{if(b&&c<b.toInt()){$testRemind(d,"密码长度不能小于"+b+"位",true);d.focus();d.select();return false}}}return true},funTestPwdChk:function(d,a){var b=d.val(),c=a.val();if(c===""){$testRemind(a,this.txtRemKey+"确认"+this.txtPwd,true);a.focus();return false}else{if(c!==b){$testRemind(a,this.txtRemKey2+this.txtPwd+"前后不一致",true);a.focus();a.select();return false}}return true},funTestCode:function(b,a){var c=b.val().trim(),a=a||"^\\w{4}$";if($isEmpty(b)){$testRemind(b,this.txtRemKey+this.txtCode,true);b.focus();return false}else{if(!c.test(a)){$testRemind(b,this.txtRemKey2+this.txtCode+this.txtRemKey3,true);b.focus();b.select();return false}}return true},funTestZipcode:function(a,b){var c=DBC2SBC(a.val().trim());if($isEmpty(a)){if(b){$testRemind(a,this.txtRemKey+this.txtZipcode,true);a.focus();return false}}else{if(!c.test($isRegex.ZIPCODE)){$testRemind(a,this.txtRemKey2+this.txtZipcode+this.txtRemKey3,true);a.focus();a.select();return false}}a.val(c);return true},funTestNumber:function(a,e,d,c){var b=Number(DBC2SBC(a.val().trim())),d=d||"内容";if($isEmpty(a)){if(e){$testRemind(a,this.txtRemKey+d,true);a.focus();return false}}else{if(b!==0){if((!b||b<0)||(c&&b!==b.toInt())){$testRemind(a,"请输入不小于0的"+(c?"整":"")+"数值",true);a.focus();a.select();return false}a.val(b)}}return true},funTestDate:function(b,d,c){var a=b.val(),e=a.match(/\d+/g);if($isEmpty(b)){if(d){$testRemind(b,this.txtRemKey+(c||"日期"),true);b.focus();return false}}else{if(!e||e.length!==3||e[0].length!==4||e[1].length>2||e[2].length>2){$testRemind(b,this.txtRemKey2+"日期"+this.txtRemKey3,true);b.focus();b.select();return false}}return e?Date.parse(e[1].toInt()+"/"+e[2].toInt()+"/"+e[0].toInt()):true},funCompareDate:function(c,b){var d=this.funTestDate(c),a=this.funTestDate(b);if(!d||!a){return false}if(d!=true&&a!=true&&d>a){$testRemind(b,"结束时间需大于开始时间",true);b.focus();b.select();return false}return true},funTestUrl:function(a,d,b){var c=DBC2SBC(a.val().trim());if($isEmpty(a)){if(d){$testRemind(a,this.txtRemKey+(b||this.txtUrl),true);a.focus();return false}}else{if(!c.test($isRegex.URL)){$testRemind(a,this.txtRemKey2+(b||this.txtUrl)+this.txtRemKey3,true);a.focus();a.select();return false}}a.val(c);return true}};var $autoRemind=function(c,b){var f=$extend({label:false},b||{});var g=$isEle(c)&&c.attr("placeholder"),e=g&&c.val().trim();var d="placeholder" in document.createElement("input"),a=null;if(!g){return}if(d){c.removeClass("g9");if(g===e){c.val("")}return}if(!f.label){$classToggle(c,{eventType:"focus",inCall:function(){if(this.val().trim()===g){this.val("")}this.style.color=""},outCall:function(){if(this.val().trim()===""){this.css("color","graytext").val(g)}}});if(!e||e===g){c.css("color","graytext").val(g)}else{c.style.color=""}}else{if(a=$$("label[for="+c.attr("id")+"]")[0]){$classToggle(c,{eventType:"focus",inCall:function(){a.txt("")},outCall:function(){if(this.val().trim()===""){a.txt(g)}}});if(!e||e===g){c.val("");a.txt(g)}}}};var $selectUrl=function(a){if($isEle(a)){a.addEvent("change",function(){$pageFresh(this.val())})}};$enterEvent=function(a,b){a.addEvent("keypress",function(c){if(c.key==="enter"){b.fireEvent("click");c.stop()}})};var $scrollFollow=function(b){var d=b&&b.getPosition().y,a=false;var c=function(){if(a&&d){var e=window.getScroll().y-d;b.css("top",e>0?e:0);a=false}};c.periodical(400);window.addEvent("scroll",function(){a=true})};var $smartFloat=function(c,b){var d=$extend({ie6:true,fixedCall:$empty,normalCall:$empty,zIndex:10},b||{});if(!d.ie6&&$isIe6){return}var a=function(f){var g=f.getPosition().y,e=f.getStyles("position","top","zIndex");window.addEvent("scroll",function(){var h=this.getScroll().y;if(h>g){if(!$isIe6){f.css({position:"fixed",top:0,zIndex:d.zIndex})}else{f.css({position:"absolute",top:h,zIndex:d.zIndex})}d.fixedCall.call(f)}else{f.setStyles(e);d.normalCall.call(f)}})};if($isArr(c)){return c.each(function(e){a(e)})}else{if($isEle(c)){a(c)}}};var AjaxReq=new Class({Implements:[Options,Events],options:{url:null,method:"get",data:null,headers:{},async:true,evalScripts:true,secure:false,update:false,callType:"json",timeOut:30000,onRequest:$empty,onSuccess:$empty,onError:$empty},initialize:function(b){this.setOptions(b);var a={url:this.options.url,method:this.options.method,data:this.options.data,headers:this.options.headers,async:this.options.async,evalScripts:this.options.evalScripts,secure:this.options.secure,update:this.options.update};a.onRequest=this.request.bind(this);a.onSuccess=this.success.bind(this);a.onFailure=a.onException=a.onCancel=this.error.bind(this);switch(this.options.callType){case"html":this.ajax=new Request.HTML(a);break;case"json":this.ajax=new Request.JSON(a);break}return this},error:function(){if(this.options.timeOut){$clear(this.options.timeOut)}this.fireEvent("error");return this},success:function(f,e,h,g){if(this.options.timeOut){$clear(this.options.timeOut)}if(this.options.callType=="html"){if(this.$events.success){this.fireEvent("success",[f,e,h,g])}}else{if(this.$events.success){this.fireEvent("success",[f,e])}}return this},request:function(){this.fireEvent("request");return this},send:function(a){this.options.timeOut=setTimeout(function(){this.ajax.cancel()}.bind(this),this.options.timeOut);this.ajax.send(a)}});var Overlay=new Class({Implements:[Options,Events],getOptions:function(){return{useFx:false,name:"",duration:200,colour:"#000",opacity:0.35,zIndex:99,container:document.body,onClick:$empty}},initialize:function(a){this.setOptions(this.getOptions(),a);this.options.container=$(this.options.container);this.container=new Element("div").setProperty("id",this.options.name+"_overlay").setStyles({position:"absolute",left:"0",top:"0",width:"100%",height:"100%",backgroundColor:this.options.colour,zIndex:this.options.zIndex,opacity:this.options.opacity}).inject(this.options.container);this.options.useFx?this.fade=new Fx.Tween(this.container,{property:"opacity",duration:this.options.duration}).set(0):this.fade=null;this.container.setStyle("display","none");this.container.addEvent("click",function(){this.fireEvent("click")}.bind(this));window.addEvent("resize",this.position.bind(this));return this.position()},position:function(){if(this.options.container==document.body){var a=window.getScrollHeight()+"px";this.container.setStyles({top:"0px",height:a})}else{var b=this.options.container.getCoordinates();this.container.setStyles({top:b.top+"px",height:b.height+"px",left:b.left+"px",width:b.width+"px"})}},show:function(){this.container.setStyle("display","");if(this.fade){this.fade.cancel().start(this.options.opacity)}return this.position()},hide:function(a){if(this.fade){this.fade.cancel().start(0)}this.container.setStyle("display","none");if(a){this.dispose()}return this},dispose:function(){this.container.dispose()}});var Mbox={presets:{marginImage:{x:50,y:75},width:"auto",height:"auto",url:false,type:"ele",ajax:false,ajaxAttr:"href",ajaxOptions:{},title:"提示框",ensure:"确定",cancel:"取消",clostxt:"×",loadimg:"http://s1.95171.cn/adentity/images/o_loading.gif",overlay:true,opacity:0.35,overlayClosable:false,reposition:true,closable:true,titleable:true,optable:false,dragable:true,zIndex:199,time:0,useFx:false,resizeFx:{},onShow:$empty,onClose:$empty},initialize:function(a){this.options={};this.setOptions(this.presets,a||{});this.build();this.bound={window:this.reposition.bind(this,[null]),close:this.close.bind(this),key:this.onKey.bind(this)};this.isOpen=this.elementObj=false;this.ie6=(window.XMLHttpRequest)?false:true;this.time=this.options.time.toInt();return this},build:function(){if(!this.overlay){this.overlay=new Overlay({name:"mbox",opacity:this.options.opacity,onClick:(this.options.overlayClosable)?this.close.bind(this):null,zIndex:this.options.zIndex-1})}if(!$("mboxWindow")){var a='<div class="mbox_top"></div><div id="mboxBar" class="mbox_bar"><div class="mbox_bar_top"></div><div id="mboxTitle" class="mbox_title">'+this.options.title+'</div></div><div class="mbox_close_box"><a href="javascript:;" id="mboxBtnClose" class="mbox_close" title="关闭">'+this.options.clostxt+'</a></div><div id="mboxContent" class="mbox_cont"></div><div id="mboxOperate" class="mbox_operate" style="display:none;"></div><div class="mbox_bottom"></div>';this.win=new Element("div",{id:"mboxWindow","class":"mbox_win",styles:{position:"absolute",zIndex:this.options.zIndex+2,visibility:"hidden"}}).set("html",a);document.body.adopt(this.win)}this.bar=$("mboxBar");this.title=$("mboxTitle");this.closbtn=$("mboxBtnClose");this.cont=$("mboxContent");this.opt=$("mboxOperate");return this},assign:function(b,a){b.addEvent("click",function(c){if(c){new Event(c).stop()}Mbox.open(a,this)})},open:function(a,b){a=a||{},this.initialize(a);if($isEle(b)){this.element=$(b);this.options.url=this.options.url||this.element.attr(this.options.ajaxAttr)}this.getContent()},remind:function(b,a){if(b){this.initParams();a=a||{};this.initialize(a);this.getContent('<div class="mbox_remind">'+b+"</div>");this.closbtn.invisible();this.bar.hide();this.opt.hide();if(this.time>0){this.close.delay(this.time,this)}}return this},alert:function(c,b,a){if(!c){return this}this.initParams();a=a||{};this.initialize(a);this.getContent('<div class="mbox_alert">'+c+"</div>");this.opt.show();this.bar.show();this.AlertBtnOk=new Element("input",{id:"mboxAlertOk","class":"mbox_btn_sure",type:"submit",value:this.options.ensure});this.AlertBtnOk.addEvent("click",function(){if($type(b)==="function"){b.call(this)}this.close()}.bind(this));this.opt.empty().adopt(this.AlertBtnOk);if($("mboxAlertOk")&&$("mboxAlertOk").isDisplayed){$("mboxAlertOk").focus()}if(this.time>0){this.close.delay(this.time,this)}},confirm:function(d,c,b,a){if(!d){return this}this.initParams();a=a||{};this.initialize(a);this.getContent('<div class="mbox_alert">'+d+"</div>");this.opt.show();this.bar.show();this.ConfirmBtnOk=new Element("input",{id:"mboxConfirmOk","class":"mbox_btn_sure",type:"submit",value:this.options.ensure});this.ConfirmBtnCancel=new Element("input",{id:"mboxConfirmCancel","class":"mbox_btn_cancel",type:"button",value:this.options.cancel});this.opt.empty().adopt(this.ConfirmBtnOk,this.ConfirmBtnCancel);this.ConfirmBtnOk.addEvent("click",function(){if($type(c)==="function"){c.call(this)}}.bind(this));this.ConfirmBtnCancel.addEvent("click",function(){if($type(b)==="function"){b.call(this)}this.close()}.bind(this));if($("mboxConfirmOk")&&$("mboxConfirmOk").isDisplayed){$("mboxConfirmOk").focus()}},loading:function(a){this.initialize({});a=a||'<div class="mbox_loading"><img src="'+this.options.loadimg+'" class="mbox_loading_image" />加载中...</div>';this.getContent(a);this.closbtn.invisible();this.bar.hide();this.opt.hide();return this},close:function(){if(this.isOpen){this.isOpen=false;if(this.overlay&&this.options.overlay){this.overlay.dispose();this.overlay=null}if(this.ie6){$$("select").visible()}if(this.elementObj){document.body.adopt(this.elementObj.hide())}this.cont.empty();this.opt.empty();this.win.invisible();this.closbtn.invisible();if(this.element){this.element=null}if($isFun(this.options.onClose)){this.options.onClose.call(this)}this.initParams();this.toggleListeners();this.options.onShow=$empty;this.options.onClose=$empty;if(this.fx){this.fx=null}}return false},initParams:function(){this.options={};this.setOptions(this.presets)},toggleListeners:function(b){var a=(b)?"addEvent":"removeEvent";this.closbtn[a]("click",this.bound.close);document[a]("keydown",this.bound.key);if(this.options.reposition){window[a]("resize",this.bound.window);if($isIe6){window[a]("scroll",this.bound.window)}}},getContent:function(e){this.toggleListeners(true);if(e){return this.applyContent(e)}var f=this.options.type,a=this.options.url,d=this.options;if(!a){return false}if(this.options.ajax){this.loading();this.options=d;var h=this.options.width.toInt()||600,g=this.options.height.toInt()||400;switch(f){case"image":var c=new Image(),j=a;c.onload=function(){var o=document.getSize(),n;o.x-=this.options.marginImage.x;o.y-=this.options.marginImage.y;n={x:c.width,y:c.height};for(var m=2;m--;){if(n.x>o.x){n.y*=o.x/n.x;n.x=o.x}else{if(n.y>o.y){n.x*=o.y/n.y;n.y=o.y}}}n.x=n.x.toInt();n.y=n.y.toInt();this.applyContent('<img class="mbox_ajax_image" src="'+j+'" width="'+n.x+'" height="'+n.y+'" />')}.bind(this);c.onerror=function(){this.alert("图片加载没有成功！")}.bind(this);c.src=j;break;case"iframe":var b={src:a,styles:{width:h,height:g,background:"url("+this.options.loadimg+") no-repeat center",border:0},"class":"mbox_ajax_iframe",frameborder:0};this.applyContent(new IFrame(b));break;case"ajax":var l=this;new Request.HTML($merge({method:"get"},$extend({evalScripts:false},this.options.ajaxOptions))).addEvents({onFailure:this.onError.bind(this),onComplete:function(n,m,p,o){l.applyContent(p,o)}}).send({url:a});break;case"swf":var k='<object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" width="'+h+'" height="'+g+'" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0"><param name="quality" value="high" /><param name="src" value="'+a+'" /><param name="wmode" value="transparent" /><embed type="application/x-shockwave-flash" wmode="transparent" width="'+h+'" height="'+g+'" src="'+a+'" quality="high"></embed></object>';this.options.height="auto";this.applyContent(k);break;default:return this.applyContent(a)}}else{if($isStr(a)){a=a.replace(/^#/,"");if($(a)){a=$(a)}}return this.applyContent(a)}},applyContent:function(content,js){var position=this.cont.css("position");if($isStr(content)){this.cont.set("html",content).css("position","absolute")}else{if($type(content)==="element"){this.elementObj=content;this.cont.empty().adopt(content.show()).css("position","absolute")}else{return this}}this.winsize=this.cont.getSize();this.cont.setStyle("position",position);this.title.set("html",this.options.title);this.closbtn.set("html",this.options.clostxt);this.showControl();this.reposition();this.win.visible();this.isOpen=true;if(this.ie6){$$("select").invisible()}if(js){eval(js)}if($isFun(this.options.onShow)){this.options.onShow.call(this)}return this},showControl:function(){if(this.options.closable){this.closbtn.visible()}else{this.closbtn.invisible()}if(this.overlay&&this.options.overlay){this.overlay.show()}if(this.options.titleable){this.bar.show()}else{this.bar.hide()}if(this.options.optable){this.opt.show()}else{this.opt.hide()}if(this.options.dragable){$startDrag(this.title,this.win)}},reposition:function(e){var f=this.winsize?this.winsize.x:this.win.w(),d=this.win.h(),j=window.getSize().x,g=window.getSize().y,h=document.getScroll().y,k=d<g,b,m,a=this.options.width.toInt(),n=this.options.height.toInt();d=n||d,f=a||f;this.win.setStyle("height",d);b=(j-f)/2;m=(g-d)/2+h;if(this.ie6||!this.options.reposition){this.win.setStyle("position","absolute");m=k?((g-d)/2+h):(50+h)}else{m=k?((g-d)/2):50;this.win.setStyle("position","fixed")}var l={width:f,height:d,left:b,top:m};if(this.options.useFx||e===true){this.fx={win:new Fx.Morph(this.win,$merge({duration:750,transition:Fx.Transitions.Quint.easeOut,link:"cancel",unit:"px",onComplete:function(){if(!n){this.win.setStyle("height","auto")}}.bind(this)},this.options.resizeFx))}}if(this.fx&&!this.ie6){this.fx.win.cancel().start(l)}else{this.win.setStyles(l);if(!n){this.win.setStyle("height","auto")}}},onError:function(){this.alert("加载出了点小问题。")},onKey:function(a){switch(a.key){case"esc":if(this.closbtn.css("visibility")==="visible"){this.close(a)}case"up":case"down":return false}},extend:function(a){return $extend(this,a)}};Mbox.extend(new Options);var Calendar=new Class({Implements:[Options,Events],options:{initDate:new Date(),specialDate:[],monthText:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],weekText:["日","一","二","三","四","五","六"],range:[new Date(1949,0,1),new Date(2015,0,1)],column:false,display:true,onSelect:$empty},initialize:function(b,a){this.setOptions(a);this.initDate=this.options.initDate;this.container=$(b).store("date",this.initDate.getTime());if(!this.options.column){this.init(this.container,this.initDate)}else{this.thisMonth=new Element("div").addClass("mcalendar_this");this.nextMonth=new Element("div").addClass("mcalendar_next");this.container.adopt(this.thisMonth,this.nextMonth);this.initDouble(this.initDate)}this.display=this.options.display;(this.display)?this.show():this.hide()},init:function(l,u){var q=this.options.specialDate;l.set("html","");var v=this.MonthInfo(u.getFullYear(),u.getMonth());l.addClass("mcalendar");var c=[];c.push("<li class='mcalendar_logo'></li>");if(this.options.column){c.push("<li class='mcalendar_year'><span>"+u.getFullYear()+"年</span></li>");c.push("<li class='mcalendar_month'><span>"+this.options.monthText[u.getMonth()]+"</span></li>")}else{c.push("<li class='mcalendar_year'><a href='javascript:' cal='year' year='"+u.getFullYear()+"'>"+u.getFullYear()+"年</a></li>");c.push("<li class='mcalendar_month'><a href='javascript:' cal='month' month='"+u.getMonth()+"'>"+this.options.monthText[u.getMonth()]+"</a></li>")}var k=new Element("ul").set("html",c.join("")).addClass("mcalendar_top");var r=[];if(!this.options.column){r.push("<li class='mcalendar_preyear'><a href='javascript:' cal='preyear' title='上一年'> << </a></li>")}r.push("<li class='mcalendar_preweek'><a href='javascript:' cal='preweek' title='上一月'> < </a></li>");if(!this.options.column){r.push("<li class='mcalendar_today'><a href='javascript:' cal='today'>今天</a></li>")}r.push("<li class='mcalendar_nextweek'><a href='javascript:' cal='nextweek' title='下一月'> > </a></li>");if(!this.options.column){r.push("<li class='mcalendar_nextyear'><a href='javascript:' cal='nextyear' title='下一年'> >> </a></li>")}var s=new Element("ul").set("html",r.join("")).addClass("mcalendar_switch");var f=[];for(i=0;i<7;i++){f.push("<li class='mcalendar_week"+(i==0||i==6?" mcalendar_weekend":"")+"'>"+this.options.weekText[i]+"</li>")}var o=new Element("ul").set("html",f.join("")).addClass("mcalendar_weekx");l.adopt(k,s,o);if($type(this.options.specialDate)==="function"){q=this.options.specialDate.bind(u)()}for(i=0;i<6;i++){var b=new Element("ul").addClass("mcalendar_dayx");for(var p=0;p<7;p++){var t=7*i-v.firstDay+p+1;if(t>0&&t<=v.days){var g=u.getFullYear(),n=u.getMonth();var a=new Date(g,n,t);if(a>=this.options.range[0]&&a<=this.options.range[1]){var e="",h="";if($type(q)==="array"){q.each(function(j){var d=j.match(/\d+/g);if(!e&&d&&d.length===3&&d[0].toInt()===g&&(d[1].toInt()===n+1)&&d[2].toInt()===t){e=" mcalendar_special"}})}if(t==new Date(this.container.retrieve("date")).getDate()&&n==new Date(this.container.retrieve("date")).getMonth()){h="mcalendar_selected"}b.grab(new Element("li").set("html","<a href='javascript:' class='"+h+e+"' year='"+g+"' month='"+n+"' date='"+t+"'>"+t+"</a>"))}else{b.grab(new Element("li").addClass("mcalendar_outrange").set("html",t))}}else{b.grab(new Element("li").addClass("mcalendar_invalid").set("html","&nbsp;"))}}l.adopt(b)}l.getElements("a").addEvent("focus",function(){this.blur()});l.getElements("a").addEvent("click",function(z){var d=new Event(z).target;if($(d).getProperty("cal")=="today"){this.init(l,new Date());this.fireEvent("select",[new Date()])}else{if($(d).getProperty("cal")=="preyear"){u.setFullYear(u.getFullYear()-1);this.init(l,u)}else{if($(d).getProperty("cal")=="nextyear"){u.setFullYear(u.getFullYear()+1);this.init(l,u)}else{if($(d).getProperty("cal")=="preweek"){if(this.options.column){u.setMonth(u.getMonth()-2);this.initDouble(u)}else{u.setMonth(u.getMonth()-1);this.init(l,u)}}else{if($(d).getProperty("cal")=="nextweek"){if(this.options.column){this.initDouble(u)}else{u.setMonth(u.getMonth()+1);this.init(l,u)}}else{if($(d).getProperty("cal")=="year"){var y=new Element("select").setStyle("width","52px").setStyle("height","20px");var x=$(d).getProperty("year");for(var m=this.options.range[0].getFullYear();m<=this.options.range[1].getFullYear();m++){y.grab(new Element("option").setProperty("value",m).set("html",m))}y.addEvent("change",function(C){var B=new Event(C).target;u.setFullYear(B.value);this.init(l,u)}.bind(this));y.setProperty("value",x);y.replaces($(d))}else{if($(d).getProperty("cal")=="month"){var w=new Element("select").setStyle("width","46px").setStyle("height","20px");var x=$(d).getProperty("month");for(m=0;m<12;m++){w.grab(new Element("option").setProperty("value",m).set("html",this.options.monthText[m]))}w.addEvent("change",function(C){var B=new Event(C).target;u.setMonth(B.value);this.init(l,u)}.bind(this));w.setProperty("value",x);w.replaces($(d))}else{var A=this.container.getElements(".mcalendar_selected"),j=new Date($(d).getProperty("year"),$(d).getProperty("month"),$(d).getProperty("date"));if(A){A.removeClass("mcalendar_selected")}d.className="mcalendar_selected";this.container.store("date",j.getTime());this.fireEvent("select",[j])}}}}}}}return false}.bind(this))},initDouble:function(a){this.init(this.thisMonth,a);a.setMonth(a.getMonth()+1);this.init(this.nextMonth,a)},MonthInfo:function(e,a){var b=[31,28,31,30,31,30,31,31,30,31,30,31];var c=(new Date(e,a,1));c.setDate(1);if(c.getDate()==2){c.setDate(0)}e+=1900;return{days:a==1?(((e%4==0)&&(e%100!=0))||(e%400==0)?29:28):b[a],firstDay:c.getDay()}},show:function(){this.display=true;this.container.setStyle("display","")},hide:function(){this.display=false;this.container.setStyle("display","none")},dispose:function(){this.container.empty()}});var Datepicker=new Class({Implements:[Options],options:{initDate:"",specialDate:[],initValue:"",htmlInsert:"",column:false,monthText:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],weekText:["日","一","二","三","四","五","六"],range:[new Date(1970,0,1),new Date(2015,0,1)],splitChar:"-",onSelect:$empty},initialize:function(c,b,a){this.setOptions(a);this.calendar=null;this.container=null;this.ele=$(c);this.ele.addEvent("click",function(g){var f=this.options.initValue;if(f&&b.value===f){b.value=""}b.style.color="";if(this.calendar){this.calendar.display?this.calendar.hide():this.calendar.show();return}var d=this.ele;if(!this.container){this.container=new Element("div").setProperty("id",$time()+"_date")}var h=$(d).getCoordinates();this.container.setStyles({position:"absolute",left:h.left,top:h.bottom});$(document.body).grab(this.container);var j=this.options.initDate||new Date();this.calendar=new Calendar(this.container,{initDate:j,specialDate:this.options.specialDate,range:this.options.range,monthText:this.options.monthText,weekText:this.options.weekText,column:this.options.column,onSelect:function(k){var l=k.getFullYear(),m=(k.getMonth()+1),e=k.getDate();if(m<10){m="0"+m}if(e<10){e="0"+e}if(this.options.splitChar){b.value=l+this.options.splitChar+m+this.options.splitChar+e}else{b.value=l+"年"+m+"月"+e+"日"+(this.options.splitChar===false?" 星期"+this.options.weekText[k.getDay()]:"")}this.calendar.hide();this.options.onSelect.call(b,k)}.bind(this)})}.bind(this));document.addEvent("mousedown",this.insideSelector.bind(this))},insideSelector:function(a){if($(a.target).getParents(".mcalendar").length===0&&a.target!==this.ele&&this.calendar){this.calendar.hide()}},dispose:function(){if(this.calendar){this.calendar.dispose()}}});Element.implement({getOffsetParent:function(){var a=this.getDocument().body;if(this==a){return null}if(!Browser.Engine.trident){return $(this.offsetParent)}var b=this;while((b=b.parentNode)){if(b==a||Element.getComputedStyle(b,"position")!="static"){return $(b)}}return null},getCaretPosition:function(){if(!Browser.Engine.trident){return this.selectionStart}this.focus();var a=document.selection.createRange();var b=this.createTextRange();a.setEndPoint("StartToStart",b);return a.text.length},selectRange:function(c,a){if(Browser.Engine.trident){var b=this.createTextRange();b.collapse(true);b.moveEnd("character",a);b.moveStart("character",c);b.select()}else{this.focus();this.setSelectionRange(c,a)}return this}});var Autocompleter=new Class({Implements:[Options,Events],options:{enable:true,minLength:1,width:"inherit",height:"auto",adjust:{x:0,y:0},maxChoices:10,className:"autocompleter",selectClass:"ac_select",closeClass:"ac_close",moreClass:"ac_more",zIndex:999,delay:200,observerOptions:{},fxOptions:{},extraParams:{},autoSubmit:true,autoTrim:true,autoClose:true,filter:null,parser:null,selectMode:true,wordSync:true,multiple:false,separatorSplit:",",filterSubset:false,filterCase:false,listCloseBtn:true,onSelection:$empty,onShow:$empty,onHide:$empty,onBlur:$empty,onFocus:$empty},initialize:function(c,b,a){this.element=$(c);this.setOptions(a);this.build();this.observer=new Observer(this.element,this.fetch.bind(this),$merge({delay:this.options.delay},this.options.observerOptions));this.queryValue=null;if(this.options.filter){this.filter=this.options.filter.bind(this)}this.selectMode=this.options.selectMode;this.enable=this.options.enable;this.extraParams=this.options.extraParams;($type(b)==="array")?this.remote=false:this.remote=true;this.cached=false;this.cacheStatus="loading";this.url=b},build:function(){this.choices=new Element("ul",{"class":this.options.className,styles:{zIndex:this.options.zIndex,position:"absolute",top:"-99em"}}).inject(document.body);this.fx=(!this.options.fxOptions)?null:new Fx.Tween(this.choices,$merge({property:"opacity",link:"cancel",duration:200},this.options.fxOptions)).addEvent("onStart",Chain.prototype.clearChain).set(0);this.element.setProperty("autocomplete","off").addEvent("keyup",this.onCommand.bind(this)).addEvent("focus",this.toggleFocus.create({bind:this,arguments:true,event:true})).addEvent("blur",this.toggleFocus.create({bind:this,arguments:false,event:true}));this.choices.onmousedown=function(){return false}},destroy:function(){if(this.fix){this.fix.dispose()}this.choices=this.selected=this.choices.destroy()},toggleFocus:function(b,a){b.stop();this.focussed=a;if(!this.focussed){if(this.options.autoClose){this.hideChoices(true)}}else{this.prefetch()}this.fireEvent((a)?"onFocus":"onBlur",[this.element])},onCommand:function(b){if(b&&b.key&&!b.shift){switch(b.key){case"enter":b.stop();if(this.element.value!=this.opted){return true}if(this.selected&&this.visible){this.choiceSelect(this.selected);return !!(this.options.autoSubmit)}break;case"up":case"down":if(this.visible&&this.queryValue!==null){var a=(b.key=="up");if(this.selected&&this.selected.getNext()&&this.selected.getNext().hasClass(this.options.closeClass)){a?this.choiceOver(this.selected.getPrevious(),true):this.choiceOver(this.choices.getFirst(),true)}else{this.choiceOver((this.selected||this.choices)[(this.selected)?((a)?"getPrevious":"getNext"):((a)?"getLast":"getFirst")](),true)}}return false;case"esc":case"tab":this.hideChoices(true);break}}return true},prefetch:function(){if(this.cacheStatus=="loaded"){return true}if(!this.remote){this.cached=this.url;this.cacheStatus="loaded"}else{this.ajaxReq=new AjaxReq({url:this.url,callType:"json",onSuccess:function(d,c){this.cached=d;this.update(this.cached.msg.shop)}.bind(this)});this.cached=[];this.cacheStatus="loaded"}},fetch:function(){if(!this.enable){return false}if(this.cacheStatus!="loaded"){return false}var f=this.element.value,e=f,b=0;if(this.options.multiple){var c=this.options.separatorSplit;var a=f.split(c);b=this.element.getCaretPosition();var g=f.substr(0,b).split(c);var d=g.length-1;b-=g[d].length;e=a[d]}if(e.length<this.options.minLength){this.hideChoices()}else{this.queryIndex=b;if((JSON.encode(this.extraParams)===this.queryExtraParams&&e===this.queryValue)||(this.visible&&e==this.selectedValue)){if(this.visible){return false}this.showChoices()}else{this.queryExtraParams=JSON.encode(this.extraParams);this.queryValue=e;if(this.remote){new AjaxReq({url:this.makeUrl(),callType:"json",onSuccess:function(j,h){this.cached=j;var k=this.options.parser(this.cached);if($type(k)=="array"){this.update(k)}else{if($type(k.data)=="array"&&k.more){this.update(k.data,k.more)}}}.bind(this)}).send()}else{this.update(this.filter(this.cached))}}}return true},makeUrl:function(){var a=this.url+"?fgsearchq="+this.queryValue.cnEncode();for(var b in this.extraParams){a=a+"&"+b+"="+this.extraParams[b].cnEncode()}return a},filter:function(c){var b=new RegExp(((this.options.filterSubset)?"":"^")+this.queryValue.escapeRegExp(),(this.options.filterCase)?"":"i");var a=[];(c||this.tokens).each(function(d){if(b.test(d)){a.push(d)}},this);return a},setSelection:function(j){var k=this.selectedValue,l=k;if(!k){return false}var c=this.queryValue.length,e=k.length;if(k.substr(0,c).toLowerCase()!=this.queryValue.toLowerCase()){c=0}if(this.options.multiple){var h=this.options.separatorSplit;l=this.element.value;c+=this.queryIndex;e+=this.queryIndex;var d=l.substr(this.queryIndex).split(h,1)[0];l=l.substr(0,this.queryIndex)+k+l.substr(this.queryIndex+d.length);if(j){var a=/[^\s,]+/;var g=[];l.split(this.options.separatorSplit).each(function(n){if(a.test(n)){g.push(n)}},this);var m=this.options.separatorSplit;l=g.join(m)+m;e=l.length}}if(this.options.wordSync){this.observer.setValue(l)}this.opted=l;if(j){c=e}this.element.selectRange(c,e);var f=0;if(this.selected.getElement("span")){f=this.selected.getElement("span").get("html")}var b=l;if(this.options.autoSubmit&&j){this.fireEvent("onSelection",[this.element,this.selected,f,b])}},showChoices:function(){var d=this.choices.getFirst(),c=this.choices.getLast(),b;if(!d||this.visible){return}var e=this.element.getCoordinates(),a=this.options.width||"auto";if($type(this.options.height)==="number"){(c.getCoordinates(this.choices).bottom>this.options.height)?b={"overflow-y":"scroll",height:this.options.height}:b={"overflow-y":"hidden",height:this.options.height}}else{b={"overflow-y":"hidden",height:this.options.height}}b=$merge(b,{left:e.left+this.options.adjust.x,top:e.bottom+this.options.adjust.y,width:(a===true||a=="inherit")?(e.width-2):a,visibility:"visible"});if(!this.visible){this.visible=true;this.choices.setStyles(b);if(this.fx){this.fx.start(1)}if(this.fix){this.fix.show()}this.fireEvent("onShow",[this.element,this.choices])}},hideChoices:function(a){if(a){var c=this.element.value;if(this.options.autoTrim){c=c.split(this.options.separatorSplit).filter($arguments(0)).join(this.options.separatorSplit)}this.observer.setValue(c)}if(!this.visible){return}this.visible=false;this.observer.clear();var b=function(){this.choices.setStyle("visibility","hidden");if(this.fix){this.fix.hide()}}.bind(this);this.fx?this.fx.start(0).chain(b):b();this.fireEvent("onHide",[this.element,this.choices])},update:function(f,b){this.choices.empty();if(this.selected){this.selected=this.selectedValue=null}if(!f||!f.length){this.hideChoices()}else{if(this.options.maxChoices<f.length){f.length=this.options.maxChoices}f.each(function(h){var j=h.split("|");var g=new Element("li",{html:this.markQueryValue(j)});g.inputValue=j[0].stripHTML();this.addChoiceEvents(g);g.inject(this.choices)},this);if(b&&b.text&&b.link){var e=new Element("a").addClass("ac_more_a").setProperty("href",b.link).set("html",b.text);var a=new Element("li").addClass(this.options.moreClass);a.grab(e);a.inject(this.choices)}if(this.options.listCloseBtn){var d=new Element("a").addClass("ac_close_a").setStyle("margin-left","8px").setProperty("href","javascript:;").set("html","关闭").addEvent("click",function(){this.hideChoices(true);return false}.bind(this));var c=new Element("li").addClass(this.options.closeClass);c.grab(d);c.inject(this.choices)}this.showChoices()}},markQueryValue:function(a){if(a.length===1){return a[0]}else{if(a.length===2){return'<span class="r dn">'+a[1]+"</span>"+a[0]}else{return'<span class="r dn">'+a[1]+'</span><span class="ac_add r">'+a[2]+"</span>"+a[0]}}},addChoiceEvents:function(a){return a.addEvents({mouseover:this.choiceOver.bind(this,a),click:this.choiceSelect.bind(this,a)})},choiceOver:function(a,b){if(!a||a==this.selected){return}if(this.selected){this.selected.removeClass(this.options.selectClass)}this.selected=a.addClass(this.options.selectClass);this.fireEvent("onSelect",[this.element,this.selected,b]);if(!b){return}if(this.selectMode){this.selectedValue=this.selected.inputValue;this.setSelection()}},choiceSelect:function(a){if(a){this.choiceOver(a)}this.selectedValue=this.selected.inputValue;this.setSelection(true);this.queryValue=null;this.hideChoices()}});var Observer=new Class({Implements:[Options,Events],options:{periodical:false,delay:1000},initialize:function(c,a,b){this.setOptions(b);this.addEvent("onFired",a);this.element=$(c)||$$(c);this.boundChange=this.changed.bind(this);this.resume()},changed:function(){var a=this.element.get("value");if((this.value==a||JSON.encode(this.value)==JSON.encode(a))){return}this.clear();this.value=a;this.timeout=this.onFired.delay(this.options.delay,this)},setValue:function(a){this.value=a;this.element.set("value",a);return this.clear()},onFired:function(){this.fireEvent("onFired",[this.value,this.element])},clear:function(){$clear(this.timeout||null);return this},pause:function(){$clear(this.timeout);$clear(this.timer);this.element.removeEvent("keyup",this.boundChange);return this},resume:function(){this.value=this.element.get("value");if(this.options.periodical){this.timer=this.changed.periodical(this.options.periodical,this)}else{this.element.addEvent("keyup",this.boundChange)}return this}});var AjaxPost=new Class({Implements:[Options],options:{url:"",remind:null,text:"",eleText:null,delay:0,data:{},callback:$empty},initialize:function(b,a){this.setOptions(a);this.ele=$(b);this.options.url=this.options.url||this.ele.attr("href")},href:function(){this.ele.addEvent("click",function(){this.send();return false}.bind(this))},send:function(){var c=this.options,b=this.ele,a=c.eleText||b,e=a.get("tag")==="input"?"val":"txt",d=a[e]();if(!b){return}if(c.url&&b.retrieve("ajax")!=false){b.store("ajax",false);if(c.text){a[e](c.text)}new AjaxReq({url:c.url,data:c.data,method:"post",onSuccess:function(f){b.store("ajax",true);$jsonHandle(f,c);if(c.text){a[e](d)}if(f.succ&&$isFun(c.callback)){c.callback(f)}return false},onError:function(){b.store("ajax",true);var f={succ:false,msg:"抱歉，由于系统的原因，刚才的操作没有成功，您可以稍后重试。"};$jsonHandle(f,c);if(c.text){a[e](d)}return false}}).send()}}});var JsonpGet=new Class({Implements:[Options],options:{id:$time(),url:"",onSuccess:$empty,onError:$empty},initialize:function(a){this.setOptions(a);this.script=new Element("script",{type:"text/javascript",id:this.options.id})},send:function(){var a=this.script;if(a.readyState){a.onreadystatechange=function(){if(a.readyState==="loaded"||a.readyState==="complete"){a.onreadystatechange=null;this.options.onSuccess.call(this,a)}}.bind(this)}else{a.onload=function(){this.options.onSuccess.call(this,a)}.bind(this);a.onerror=function(){this.options.onError.call(this,a)}.bind(this)}a.src=this.options.url;document.getElementsByTagName("head")[0].appendChild(a)}});var $loadScript=function(a,c,b){new JsonpGet({url:a,id:b||$time(),onSuccess:c||$empty}).send()};var $jsonHandle=function(a,b){b=b||{};b.delay=(b.delay||0)&&b.delay.toInt();if($isObj(a)){var c=function(){setTimeout(function(){if(a.url){$pageFresh(a.url)}else{if(a.refresh){$pageFresh()}}},b.delay||15)};if(a.msg){if(b.remind&&$(b.remind)){if(a.succ){$(b.remind).html(a.msg).swapClass("co","cg")}else{$(b.remind).html(a.msg).swapClass("cg","co")}if(b.delay>0){setTimeout(function(){$(b.remind).empty()},b.delay)}}else{if(Mbox.isOpen){Mbox.close()}Mbox.alert(a.msg,null,{time:b.delay||a.delay||0,onShow:function(){$testRemind.hide()},onClose:function(){if(a.sync){c()}}})}}if(!a.sync){c()}}else{$jsonHandle({succ:false,msg:"抱歉，返回的内容有异常，刚才的操作可能并未受理。"},b)}};var $formSubmit=function(b,a){var c=b&&b.getParents("form")[0];if(c){new AjaxPost(b,$extend({url:c.attr("action"),data:c.toQueryString()},a||{})).send()}};